# Task 2.4: Configure WAN Firewall Rule (Allow WireGuard)

**Objective**: Allow WireGuard VPN traffic from internet (ONLY public-facing service).

**Steps**:
1. In OPNsense: **Firewall → Rules → WAN**
2. Click **Add** button (create new rule at top - important: this should be the first rule)
3. Configure the rule:
   - **Action**: `Pass` (allow the traffic)
   - **Disabled**: ❌ Leave unchecked (rule should be enabled)
   - **Quick**: Leave unchecked (default behavior is fine)
   - **Interface**: `WAN` (traffic coming from internet)
   - **Direction**: Leave as default (`in` - traffic coming into the firewall)
   - **TCP/IP Version**: `IPv4` (or `IPv4+IPv6` if you need IPv6 support)
   - **Protocol**: `UDP` (WireGuard uses UDP)
   - **Source**: Leave as `Any` (traffic can come from any IP on internet)
   - **Destination**: `This firewall (WAN address)` or `WAN address` (traffic destined for OPNsense)
   - **Destination port range**: 
     - Select **Other** from the dropdown (51820 is not in the common ports list)
     - **from**: `51820`
     - **to**: `51820` (single port)
     - **Note**: WireGuard uses port 51820/UDP, which isn't in the common ports dropdown, so "Other" must be selected
   - **Log**: Leave unchecked (optional - enable if you want to log WireGuard connections)
   - **Category**: Leave empty (optional - used for organizing rules, not needed for this rule)
   - **Description**: `Allow WireGuard VPN (ONLY public service)`
   - **No XMLRPC Sync**: Leave unchecked (unless you have multiple OPNsense instances)
   - **Schedule**: Leave as default (rule always active)
   - **Gateway**: Leave as default (not needed for this rule)
   - Other fields: Leave as defaults
4. Click **Save**
5. Click **Apply Changes**

**Important - Rule Ordering**: 
- **Auto-generated rules cannot be moved** - they're system rules and locked in position
- **Your WireGuard rule CAN be moved** - use the up/down arrows to reorder it
- **Ideal position**: Move your WireGuard rule to be right after the system rules (DHCP, IPv6 requirements) but before the block rules (bogons, private networks)
- **Why**: This ensures WireGuard traffic is allowed before block rules are evaluated
- **To reorder**: Click your WireGuard rule, use the **up arrow** repeatedly to move it higher
- **Note**: If you can't move it above certain system rules, that's fine - place it as high as possible (after system rules, before block rules)

**Test**:
```bash
# Verify rule exists
# Navigate to: Firewall → Rules → WAN
# Should see rule allowing UDP port 51820
```

**Expected Result**: WAN firewall allows WireGuard traffic on port 51820.
